# GitHub Copilot Context

This file provides context for GitHub Copilot when working on this project.

## Project Context

This is `gapir` (Graph API Review) - a CLI tool for Azure DevOps pull request management. It helps reviewers quickly see PRs assigned to them with intelligent status analysis.

## Code Style & Patterns

### Established Patterns
- **Options Pattern**: Use `PullRequestCheckerOptions` for configuration instead of multiple parameters
- **System.CommandLine**: All CLI options use the modern System.CommandLine framework
- **Progress Indication**: Long-running operations (>1 sec) use the `Spinner` class
- **Async/Await**: All I/O operations are properly async
- **Nullable Reference Types**: Enabled - handle null cases explicitly

### Naming Conventions
- **CLI Options**: Use both short (`-d`) and long (`--show-detailed-info`) forms
- **Status Codes**: 3-letter abbreviations (REJ, WFA, PRA, POA, POL)
- **Methods**: Descriptive names reflecting Azure DevOps concepts

### Architecture Principles
1. **Separation of Concerns**: Each class has a focused responsibility
2. **Fail Gracefully**: Multiple fallback strategies for data fetching
3. **User Experience First**: Clear progress indication, sensible defaults
4. **Performance Aware**: Caching, optional expensive operations

## Common Tasks

### Adding New CLI Options
1. Add property to `PullRequestCheckerOptions`
2. Create `Option<T>` in `Program.cs` with short/long aliases
3. Add to `rootCommand.AddOption()`
4. Update handler parameter list and option mapping
5. Use in `PullRequestChecker` via `_options.PropertyName`

### Adding New Status Analysis
- Modify `GetPendingReason()` method in `PullRequestChecker`
- Follow priority order: REJ > WFA > PRA > POA > POL
- Add new 3-letter status code with clear documentation

### Adding Progress Indication
```csharp
using (var spinner = new Spinner("Operation description..."))
{
    var result = await LongRunningOperation();
    spinner.Success("Completed successfully");
}
```

## Key Files

- `Program.cs`: CLI entry point, System.CommandLine setup
- `PullRequestChecker.cs`: Core business logic, Azure DevOps integration
- `PullRequestCheckerOptions.cs`: Configuration object
- `Spinner.cs`: Progress indication utility
- `ConsoleAuth.cs`: Authentication handling

## Azure DevOps Integration

### API Patterns
- Use `VssConnection` for authenticated access
- Cache expensive calls (group membership)
- Handle API failures gracefully with fallbacks
- Filter out system accounts in reviewer lists

### Vote Values
- `10`: Approved
- `5`: Approved with suggestions  
- `0`: No vote
- `-5`: Waiting for author
- `-10`: Rejected

## Testing Considerations

When adding features:
- Consider different Azure DevOps configurations
- Test with and without verbose logging
- Verify spinner behavior during development
- Test error scenarios (network issues, auth failures)

## Performance Notes

- Group membership calls are expensive - cache results
- Detailed timing requires extra API calls - make optional
- Spinner updates shouldn't block main operations
- Package lock file improves restore performance

## Future-Proofing

The codebase is designed for:
- Multiple output formats (JSON, CSV in future)
- Configuration file support
- Multiple organization support
- Integration with other tools
- Extended authentication methods
